  SELECT    EF_KARDEX.EMPRESAID,    EF_KDX_SUBGRUPO.SUBGRUPOID,    EF_KDX_SUBGRUPO.SIGLAGRUPO,    EF_KDX_SUBGRUPO.DESCRICAO,    /* Entradas DMC e ADC */    SUM( ( CASE EF_KARDEX.TIPODOCUMENTO           WHEN 'DMC' THEN ( DECODE( EF_KARDEX.TIPOOPERACAO, 'E', EF_KARDEX.VLRCUSTOTOTAL, 0 ) )           WHEN 'ADC' THEN ( DECODE( EF_KARDEX.TIPOOPERACAO, 'E', EF_KARDEX.VLRCUSTOTOTAL, 0 ) )           ELSE 0           END ) ) AS E_DMC_ADC,    /* Entradas Definitiva */    SUM( ( CASE EF_NATUREZAOP.TIPOMOVIMENTO           WHEN 'E'  THEN ( DECODE( EF_NATUREZAOP.MOVIMENTOESTOQUE, 'N',                                                                   /* Não processar desmembramento de custo */                                                                  ( CASE EF_KARDEX.TIPODOCUMENTO                                                                    WHEN 'DMC' THEN 0                                                                    WHEN 'ADC' THEN 0                                                                    ELSE                                                                    DECODE( EF_NATUREZAOP.NATUREZAOPID, 1272, 0,                                                                                                        1273, 0,                                                                                         EF_KARDEX.VLRCUSTOTOTAL )                                                                    END ),                                                                   'Q',                                                                    /* Não processar desmembramento de custo */                                                                  ( CASE EF_KARDEX.TIPODOCUMENTO                                                                    WHEN 'DMC' THEN 0                                                                    WHEN 'ADC' THEN 0                                                                    ELSE                                                                    DECODE( EF_NATUREZAOP.NATUREZAOPID, 1272, 0,                                                                                                        1273, 0,                                                                                         EF_KARDEX.VLRCUSTOTOTAL )                                                                    END )                                    , 0 ) )           ELSE 0           END ) ) AS E_Definitiva,    /* Entradas por Devolução */    SUM( ( CASE EF_NATUREZAOP.TIPOMOVIMENTO           WHEN 'E' THEN ( DECODE( EF_NATUREZAOP.MOVIMENTOESTOQUE, 'V', EF_KARDEX.VLRCUSTOTOTAL, 0 ) )           ELSE 0           END ) ) AS E_Devolucao,    /* Entradas Ajuste Inventário */    SUM( ( CASE EF_NATUREZAOP.TIPOMOVIMENTO           WHEN 'E'  THEN ( DECODE( EF_NATUREZAOP.NATUREZAOPID, 1273, EF_KARDEX.VLRCUSTOTOTAL, 0 ) )           ELSE 0           END ) ) AS E_AJUSTE,    /* Saidas DMC e ADC  */    SUM( ( CASE EF_KARDEX.TIPODOCUMENTO           WHEN 'DMC' THEN ( DECODE( EF_KARDEX.TIPOOPERACAO, 'S', EF_KARDEX.VLRCUSTOTOTAL, 0 ) )           WHEN 'ADC' THEN ( DECODE( EF_KARDEX.TIPOOPERACAO, 'S', EF_KARDEX.VLRCUSTOTOTAL, 0 ) )           ELSE 0           END ) ) AS S_DMC_ADC,    /* Saídas Definitiva */    SUM( ( CASE EF_NATUREZAOP.TIPOMOVIMENTO           WHEN 'S'  THEN ( DECODE( EF_NATUREZAOP.MOVIMENTOESTOQUE, 'N',                                                                   /* Não processar desmembramento de custo */                                                                  ( CASE EF_KARDEX.TIPODOCUMENTO                                                                    WHEN 'DMC' THEN 0                                                                    WHEN 'ADC' THEN 0                                                                    ELSE                                                                    DECODE( EF_NATUREZAOP.NATUREZAOPID, 1272, 0,                                                                                                        1273, 0,                                                                                         EF_KARDEX.VLRCUSTOTOTAL )                                                                    END ),                                                                   'Q',                                                                    /* Não processar desmembramento de custo */                                                                  ( CASE EF_KARDEX.TIPODOCUMENTO                                                                    WHEN 'DMC' THEN 0                                                                    WHEN 'ADC' THEN 0                                                                    ELSE                                                                    DECODE( EF_NATUREZAOP.NATUREZAOPID, 1272, 0,                                                                                                        1273, 0,                                                                                         EF_KARDEX.VLRCUSTOTOTAL )                                                                    END )                                    , 0 ) )           ELSE 0           END ) ) AS S_Definitiva,    /* Saídas por Devolução */    SUM( ( CASE EF_NATUREZAOP.TIPOMOVIMENTO           WHEN 'S' THEN ( DECODE( EF_NATUREZAOP.MOVIMENTOESTOQUE, 'V', EF_KARDEX.VLRCUSTOTOTAL, 0 ) )           ELSE 0           END ) ) AS S_Devolucao,     /* Saídas Ajuste Inventário */    SUM( ( CASE EF_NATUREZAOP.TIPOMOVIMENTO           WHEN 'S'  THEN ( DECODE( EF_NATUREZAOP.NATUREZAOPID, 1272, EF_KARDEX.VLRCUSTOTOTAL, 0 ) )           ELSE 0           END ) ) AS S_AJUSTE,    /* Quantidades movimentadas */    SUM( NVL( EF_KARDEX.QUANTIDADESALDO, 0 ) ) AS QTDSALDO,     /* Qtd Entrada */    SUM( ( CASE EF_KARDEX.TIPODOCUMENTO           WHEN 'DMC' THEN 0           WHEN 'ADC' THEN 0           ELSE DECODE( EF_KARDEX.TIPOOPERACAO, 'E', EF_KARDEX.QUANTIDADE, 0 )           END ) ) AS QTD_ENTRADA,    /* Qtd Saida */    SUM( ( CASE EF_KARDEX.TIPODOCUMENTO           WHEN 'DMC' THEN 0           WHEN 'ADC' THEN 0           ELSE DECODE( EF_KARDEX.TIPOOPERACAO, 'S', EF_KARDEX.QUANTIDADE, 0 )           END ) ) AS QTD_SAIDA    FROM    EF_KARDEX EF_KARDEX,    EF_NATUREZAOP EF_NATUREZAOP,    EF_PRODUTO EF_KDX_PRODUTO,    EF_SUBGRUPO EF_KDX_SUBGRUPO   WHERE    EF_NATUREZAOP.NATUREZAOPID(+) = EF_KARDEX.NATUREZAOPID    AND EF_KDX_PRODUTO.EMPRESAID = EF_KARDEX.EMPRESAID    AND EF_KDX_PRODUTO.PRODUTOID = EF_KARDEX.PRODUTOID    AND EF_KDX_SUBGRUPO.SUBGRUPOID(+) = EF_KDX_PRODUTO.SUBGRUPOID AND EF_KARDEX.DATAOCORRENCIA >= TO_DATE('01/04/2007','DD/MM/YYYY') AND EF_KARDEX.DATAOCORRENCIA <= TO_DATE('30/04/2007','DD/MM/YYYY')AND EF_KARDEX.EMPRESAID = 12    AND NVL( EF_NATUREZAOP.VENDAFATANTECIPADO, 0 ) = 0    AND ( EF_NATUREZAOP.MOVIMENTOESTOQUE <> 'E'  OR EF_NATUREZAOP.MOVIMENTOESTOQUE IS NULL )    AND ( EF_NATUREZAOP.MOVIMENTOESTOQUE <> 'D' OR EF_NATUREZAOP.MOVIMENTOESTOQUE IS NULL )  GROUP BY    EF_KARDEX.EMPRESAID,    EF_KDX_SUBGRUPO.SUBGRUPOID,     EF_KDX_SUBGRUPO.SIGLAGRUPO,    EF_KDX_SUBGRUPO.DESCRICAO
