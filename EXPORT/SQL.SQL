 SELECT EF_PRODUTO.EMPRESAID,        EF_PRODUTO.PRODUTOID,        EF_PRODUTO.DESCRICAOPORTUGUES DESCRICAO,        EF_PRODUTO.PARTNUMBERID,         EF_GRUPO.SIGLAGRUPO GRUPO,        EF_SUBGRUPO.SIGLAGRUPO SUBGRUPO,        EF_KARDEX.DATAOCORRENCIA DATAULTIMOMOVIMENTO,        EF_KARDEX.QUANTIDADESALDO SALDO,        NVL( ROUND( EF_KARDEX.VLRCUSTOMEDIO,2 ), 0 ) CUSTOMEDIO ,        NVL( ROUND( EF_KARDEX.VLRCUSTOMEDIOTOTAL,2 ), 0 ) CUSTOMEDIOTOTAL    FROM EF_KARDEX,        EF_PRODUTO,        EF_SUBGRUPO,        EF_GRUPO,        EF_NATUREZAOP  WHERE EF_KARDEX.EMPRESAID = EF_PRODUTO.EMPRESAID AND        EF_KARDEX.PRODUTOID = EF_PRODUTO.PRODUTOID AND        EF_PRODUTO.GRUPOID = EF_GRUPO.GRUPOID(+) AND        EF_SUBGRUPO.SUBGRUPOID = EF_PRODUTO.SUBGRUPOID AND        EF_NATUREZAOP.NATUREZAOPID(+) = EF_KARDEX.NATUREZAOPID AND        (  EF_KARDEX.EMPRESAID,           EF_KARDEX.PRODUTOID,           EF_KARDEX.DATAOCORRENCIA,           EF_KARDEX.KARDEXID         ) IN        (         SELECT EF_PRODUTO.EMPRESAID,                EF_PRODUTO.PRODUTOID,                MAX(EF_KARDEX.DATAOCORRENCIA) ULTIMAMOVIMENTACAO,                MAX(EF_KARDEX.KARDEXID)  FROM EF_PRODUTO EF_PRODUTO, EF_KARDEX EF_KARDEX WHERE EF_KARDEX.EMPRESAID = EF_PRODUTO.EMPRESAID   AND EF_KARDEX.PRODUTOID = EF_PRODUTO.PRODUTOID   AND EF_KARDEX.DATAOCORRENCIA <= '31/7/2007'   AND ( EF_PRODUTO.EMPRESAID = 1OR EF_PRODUTO.EMPRESAID = 1 )    AND (SELECT COUNT(*)          FROM EF_PRODUTO    EFPRODUTO,               EF_SUBGRUPO   EF_SUBGRUPO,               EF_KARDEX     EF_KARDEX,               EF_NATUREZAOP EF_NATUREZAOP         WHERE EF_KARDEX.EMPRESAID = EFPRODUTO.EMPRESAID           AND EF_KARDEX.PRODUTOID = EFPRODUTO.PRODUTOID           AND EF_NATUREZAOP.NATUREZAOPID = EF_KARDEX.NATUREZAOPID           AND EF_KARDEX.DATAOCORRENCIA >= '31/7/2007'           AND EF_KARDEX.DATAOCORRENCIA <= '31/7/2007'           AND EF_SUBGRUPO.SUBGRUPOID = EFPRODUTO.SUBGRUPOID           AND ( EFPRODUTO.EMPRESAID = 1OR EFPRODUTO.EMPRESAID = 1 )            AND EFPRODUTO.EMPRESAID = EF_PRODUTO.EMPRESAID            AND EFPRODUTO.PRODUTOID = EF_PRODUTO.PRODUTOID) = 0           AND ( EF_PRODUTO.EMPRESAID = 1OR EF_PRODUTO.EMPRESAID = 1 )  GROUP BY EF_PRODUTO.PRODUTOID,          EF_PRODUTO.EMPRESAID )  ORDER BY EF_PRODUTO.PRODUTOID
